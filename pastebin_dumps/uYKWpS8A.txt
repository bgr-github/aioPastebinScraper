from events import Event
from filters.players import PlayerIter
from messages import SayText2
from players.entity import Player

from math import acos, degrees

@Event('weapon_fire')
def _(event_data):
	player = Player.from_userid(event_data['userid'])

	# Turn the view vector into a line.
	vv = player.view_vector * 200

	# Cycle through players.
	for target in PlayerIter():
		# Don't check yourself.
		if player.userid == target.userid:
			continue

		# Create vector from player to target.
		vt = target.origin - player.origin
		# Form dot product.
		dots = vv.dot(vt)
		# Multiply moduli of the 2 vectors.
		mods = vv.length*vt.length
		# Convert to angle. (in degrees)
		angle = degrees(acos(dots/mods))

		# Check if is inside field of view...
		if angle < 55:
			SayText2('You can see {} at {:.3} degrees from you.'.format(target.name, angle)).send(
				player.index)